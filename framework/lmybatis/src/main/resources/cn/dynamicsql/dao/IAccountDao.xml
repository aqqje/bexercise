<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dynamicsql.dao.IAccountDao">
    <!--开启二级缓存支持-->
    <cache></cache>
    <resultMap id="defMap" type="cn.dynamicsql.domain.Account">
    <result property="id" column="id"/>
    <result property="uid" column="uid"/>
    <result property="money" column="money"/>
    </resultMap>
    <resultMap id="defaultbaseMap" type="cn.dynamicsql.domain.Account">
        <result property="id" column="id"/>
        <result property="uid" column="uid"/>
        <result property="money" column="money"/>
        <association property="users" javaType="cn.dynamicsql.domain.User">
            <result property="id" column="id"/>
            <result property="username" column="username"/>
            <result property="birthday" column="birthday"/>
            <result property="sex" column="sex"/>
            <result property="address" column="address"/>
        </association>
    </resultMap>

    <resultMap id="baseMap" type="cn.dynamicsql.domain.Account">
        <result property="id" column="id"/>
        <result property="uid" column="uid"/>
        <result property="money" column="money"/>
        <association property="users" javaType="cn.dynamicsql.domain.User" select="cn.dynamicsql.dao.IUserDao.findById" column="uid"/>
    </resultMap>

    <!--userCache: true 开启二级缓存-->
    <select id="findByUid" resultMap="defMap" useCache="true">
        select * from account where uid = #{uid}
    </select>

    <select id="findAll" resultMap="baseMap">
        select u.username, u.address, a.*
        from account a, user u
        where a.uid = u.id
    </select>
</mapper>